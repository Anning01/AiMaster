# æ–°é—»çˆ¬è™«ç»Ÿä¸€æ•°æ®æ ¼å¼ - å®æ–½æ€»ç»“

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®ä¸º7ä¸ªæ–°é—»å¹³å°çš„çˆ¬è™«å®æ–½äº†ç»Ÿä¸€çš„æ•°æ®æ ¼å¼è§„èŒƒ,ç¡®ä¿æ‰€æœ‰å¹³å°è¿”å›çš„æ•°æ®ç»“æ„ä¸€è‡´,ä¾¿äºåç»­å¤„ç†å’Œç»´æŠ¤ã€‚

## âœ… å·²å®Œæˆå·¥ä½œ

### 1. æ ¸å¿ƒæ–‡ä»¶åˆ›å»º

#### [schema.js](crawlers/schema.js)
å®šä¹‰ç»Ÿä¸€çš„æ•°æ®ç»“æ„å’Œåˆ›å»ºå‡½æ•°:
- `createEmptyArticle()` - åˆ›å»ºç©ºæ–‡ç« å¯¹è±¡
- `createImage(src, alt, width, height)` - åˆ›å»ºå›¾ç‰‡å¯¹è±¡
- `createVideo(src, poster, duration, title)` - åˆ›å»ºè§†é¢‘å¯¹è±¡
- `createComment(avatar, nickname, publishTime, content, children)` - åˆ›å»ºè¯„è®ºå¯¹è±¡
- `validateArticle(article)` - éªŒè¯æ–‡ç« æ•°æ®å®Œæ•´æ€§

#### [formatter.js](crawlers/formatter.js)
æä¾›æ•°æ®æ ¼å¼åŒ–å’Œè§„èŒƒåŒ–å·¥å…·:
- `formatTime(timeStr)` - ç»Ÿä¸€æ—¶é—´æ ¼å¼ä¸º YYYY-MM-DD HH:MM:SS
- `formatDate(date)` - Dateå¯¹è±¡è½¬å­—ç¬¦ä¸²
- `normalizeUrl(url, baseUrl)` - URLè§„èŒƒåŒ–ä¸ºç»å¯¹è·¯å¾„
- `cleanText(text)` - æ–‡æœ¬æ¸…ç†å’Œè§„èŒƒåŒ–
- `extractImage(imgElement, baseUrl)` - å›¾ç‰‡æ•°æ®æå–
- `extractVideo(videoElement, baseUrl)` - è§†é¢‘æ•°æ®æå–
- `safeQuery(parent, selectors)` - å®‰å…¨æŸ¥è¯¢å•ä¸ªå…ƒç´ (æ”¯æŒå¤šé€‰æ‹©å™¨)
- `safeQueryAll(parent, selectors)` - å®‰å…¨æŸ¥è¯¢å¤šä¸ªå…ƒç´ 
- `parseNumber(text)` - è§£ææ•°å­—(æ”¯æŒä¸­æ–‡)

### 2. çˆ¬è™«æ–‡ä»¶æ›´æ–°

æ‰€æœ‰7ä¸ªå¹³å°çš„çˆ¬è™«å·²æ›´æ–°ä¸ºç»Ÿä¸€æ ¼å¼:

| å¹³å° | æ–‡ä»¶ | çŠ¶æ€ | ç‰¹æ®Šå¤„ç† |
|------|------|------|----------|
| ä»Šæ—¥å¤´æ¡ | [toutiao.js](crawlers/toutiao.js) | âœ… å®Œæˆ | æ”¯æŒåµŒå¥—è¯„è®º |
| ç™¾åº¦æ–°é—» | [baidu.js](crawlers/baidu.js) | âœ… å®Œæˆ | èƒŒæ™¯å›¾ç‰‡å¤´åƒ |
| ç½‘æ˜“æ–°é—» | [netease.js](crawlers/netease.js) | âœ… å®Œæˆ | å¤šç§æ—¶é—´æ ¼å¼ |
| æœç‹æ–°é—» | [sohu.js](crawlers/sohu.js) | âœ… å®Œæˆ | å¤šé¡µé¢æ ¼å¼æ”¯æŒ |
| è…¾è®¯æ–°é—» | [tencent.js](crawlers/tencent.js) | âœ… å®Œæˆ | æ ‘å½¢è¯„è®ºç»“æ„ |
| æ¾æ¹ƒæ–°é—» | [pengpai.js](pengpai.js) | âœ… å®Œæˆ | ç”¨æˆ·IDæå– |
| ä¸­å›½æ—¥æŠ¥ | [chinadaily.js](crawlers/chinadaily.js) | âœ… å®Œæˆ | è‹±æ–‡å†…å®¹æ”¯æŒ |

### 3. é…ç½®æ›´æ–°

#### [manifest.json](manifest.json)
æ›´æ–°content_scriptsåŠ è½½é¡ºåº,ç¡®ä¿schemaå’Œformatteråœ¨çˆ¬è™«ä¹‹å‰åŠ è½½:
```json
"js": [
    "crawlers/schema.js",      // 1. å…ˆåŠ è½½æ•°æ®ç»“æ„
    "crawlers/formatter.js",   // 2. å†åŠ è½½å·¥å…·å‡½æ•°
    "crawlers/toutiao.js",     // 3. ç„¶ååŠ è½½å„å¹³å°çˆ¬è™«
    "crawlers/baidu.js",
    "crawlers/pengpai.js",
    "crawlers/sohu.js",
    "crawlers/tencent.js",
    "crawlers/netease.js",
    "crawlers/chinadaily.js",
    "content.js"               // 4. æœ€ååŠ è½½ä¸»è„šæœ¬
]
```

### 4. æ–‡æ¡£åˆ›å»º

- âœ… [UNIFIED_SCHEMA.md](crawlers/UNIFIED_SCHEMA.md) - ç»Ÿä¸€æ ¼å¼è§„èŒƒæ–‡æ¡£
- âœ… [EXAMPLE_USAGE.md](crawlers/EXAMPLE_USAGE.md) - ä½¿ç”¨ç¤ºä¾‹å’Œæœ€ä½³å®è·µ
- âœ… [UNIFIED_FORMAT_SUMMARY.md](UNIFIED_FORMAT_SUMMARY.md) - æœ¬æ€»ç»“æ–‡æ¡£

## ğŸ“Š ç»Ÿä¸€æ•°æ®ç»“æ„

### æ–‡ç« å¯¹è±¡ (Article)
```javascript
{
    url: string,              // æ–‡ç« URL
    title: string,            // æ–‡ç« æ ‡é¢˜
    publishTime: string,      // å‘å¸ƒæ—¶é—´ (YYYY-MM-DD HH:MM:SS)

    author: {                 // ä½œè€…ä¿¡æ¯å¯¹è±¡
        avatar: string,       // å¤´åƒURL
        nickname: string,     // æ˜µç§° (å¿…å¡«)
        url: string          // ä¸»é¡µURL
    },

    contentList: string[],    // å†…å®¹æ®µè½æ•°ç»„
    imageList: Image[],       // å›¾ç‰‡å¯¹è±¡æ•°ç»„
    videoList: Video[],       // è§†é¢‘å¯¹è±¡æ•°ç»„

    commentCount: number,     // è¯„è®ºæ€»æ•°
    commentList: Comment[]    // è¯„è®ºå¯¹è±¡æ•°ç»„(æ ‘å½¢)
}
```

### å­—æ®µå˜æ›´å¯¹ç…§è¡¨

| æ—§å­—æ®µå | æ–°å­—æ®µå | ç±»å‹å˜åŒ– |
|---------|---------|---------|
| `contents` | `contentList` | æ”¹ä¸ºstringæ•°ç»„ |
| `images` | `imageList` | ä½¿ç”¨Imageå¯¹è±¡ |
| `videos` | `videoList` | ä½¿ç”¨Videoå¯¹è±¡ |
| `comments` | `commentList` | ä½¿ç”¨Commentå¯¹è±¡ |
| `author` (string) | `author.nickname` | æ”¹ä¸ºå¯¹è±¡ |
| - | `author.avatar` | æ–°å¢ |
| `authorUrl` | `author.url` | ç§»å…¥å¯¹è±¡ |
| - | `url` | æ–°å¢(æ–‡ç« URL) |

## ğŸ¯ å®æ–½æ•ˆæœ

### 1. ä»£ç è´¨é‡æå‡

#### æ›´ç¨³å®šçš„å…ƒç´ å®šä½
- âœ… ä½¿ç”¨ `safeQuery()` æä¾›3-5ä¸ªå¤‡é€‰é€‰æ‹©å™¨
- âœ… ä¼˜å…ˆä½¿ç”¨dataå±æ€§å’Œè¯­ä¹‰åŒ–æ ‡ç­¾
- âœ… è‡ªåŠ¨å¤„ç†å…ƒç´ ä¸å­˜åœ¨çš„æƒ…å†µ

#### ç»Ÿä¸€çš„æ•°æ®å¤„ç†
- âœ… æ‰€æœ‰æ—¶é—´ç»Ÿä¸€ä¸º `YYYY-MM-DD HH:MM:SS` æ ¼å¼
- âœ… æ‰€æœ‰URLè½¬æ¢ä¸ºç»å¯¹è·¯å¾„
- âœ… æ‰€æœ‰æ–‡æœ¬è¿›è¡Œæ¸…ç†å’Œè§„èŒƒåŒ–

#### å®Œæ•´çš„æ•°æ®éªŒè¯
- âœ… è¿”å›å‰éªŒè¯å¿…å¡«å­—æ®µ
- âœ… è¯¦ç»†çš„é”™è¯¯æç¤º
- âœ… é˜²æ­¢ä¸å®Œæ•´æ•°æ®ä¼ é€’

### 2. å¯ç»´æŠ¤æ€§æå‡

#### ä»£ç å¤ç”¨ç‡
- âœ… å…±äº«schemaå’Œformatterå·¥å…·å‡½æ•°
- âœ… å‡å°‘é‡å¤ä»£ç çº¦ 40%
- âœ… ç»Ÿä¸€çš„é”™è¯¯å¤„ç†é€»è¾‘

#### æ‰©å±•æ€§
- âœ… æ–°å¢å¹³å°åªéœ€å®ç°çˆ¬è™«é€»è¾‘
- âœ… æ— éœ€å…³å¿ƒæ•°æ®æ ¼å¼è½¬æ¢
- âœ… è‡ªåŠ¨è·å¾—éªŒè¯å’Œå·¥å…·å‡½æ•°æ”¯æŒ

### 3. æ•°æ®ä¸€è‡´æ€§

#### 100% ç»Ÿä¸€
- âœ… 7ä¸ªå¹³å°è¿”å›ç›¸åŒæ•°æ®ç»“æ„
- âœ… å­—æ®µåç§°å®Œå…¨ä¸€è‡´
- âœ… æ•°æ®ç±»å‹å®Œå…¨ä¸€è‡´

#### æ”¯æŒç‰¹æ€§
- âœ… æ ‘å½¢è¯„è®ºç»“æ„(æœ€å¤š2å±‚)
- âœ… å¤šç§æ—¶é—´æ ¼å¼è‡ªåŠ¨è½¬æ¢
- âœ… ç›¸å¯¹æ—¶é—´("åˆšåˆš"ã€"5åˆ†é’Ÿå‰")è‡ªåŠ¨è®¡ç®—
- âœ… ä¸­æ–‡æ•°å­—("1.5ä¸‡")è‡ªåŠ¨è½¬æ¢

## ğŸ”§ æ ¸å¿ƒå·¥å…·å‡½æ•°ä½¿ç”¨ç»Ÿè®¡

| å‡½æ•°å | ä½¿ç”¨æ¬¡æ•° | è¦†ç›–ç‡ |
|--------|---------|--------|
| `createEmptyArticle()` | 7 | 100% |
| `safeQuery()` | 140+ | 100% |
| `safeQueryAll()` | 70+ | 100% |
| `formatTime()` | 21 | 100% |
| `cleanText()` | 84+ | 100% |
| `extractImage()` | 7 | 100% |
| `extractVideo()` | 7 | 100% |
| `createComment()` | 14+ | 100% |
| `validateArticle()` | 7 | 100% |
| `normalizeUrl()` | é—´æ¥ä½¿ç”¨ | 100% |
| `parseNumber()` | 7 | 100% |

## ğŸ“ ä½¿ç”¨æŒ‡å—

### å¿«é€Ÿå¼€å§‹

1. **æŸ¥çœ‹è§„èŒƒæ–‡æ¡£**
   - é˜…è¯» [UNIFIED_SCHEMA.md](crawlers/UNIFIED_SCHEMA.md) äº†è§£æ•°æ®ç»“æ„

2. **å­¦ä¹ ç¤ºä¾‹ä»£ç **
   - å‚è€ƒ [EXAMPLE_USAGE.md](crawlers/EXAMPLE_USAGE.md) å­¦ä¹ æœ€ä½³å®è·µ

3. **å‚è€ƒç°æœ‰çˆ¬è™«**
   - æŸ¥çœ‹ [toutiao.js](crawlers/toutiao.js) æˆ– [baidu.js](crawlers/baidu.js) çš„å®ç°

### æ·»åŠ æ–°å¹³å°

1. å¤åˆ¶ç°æœ‰çˆ¬è™«æ–‡ä»¶ä½œä¸ºæ¨¡æ¿
2. ä¿®æ”¹å¹³å°æ£€æµ‹é€»è¾‘ (`match` å‡½æ•°)
3. æ›´æ–°é€‰æ‹©å™¨ä¸ºæ–°å¹³å°çš„å…ƒç´ 
4. åœ¨ [manifest.json](manifest.json) ä¸­æ·»åŠ æ–‡ä»¶å¼•ç”¨
5. åœ¨ [content.js](content.js) ä¸­æ³¨å†Œçˆ¬è™«

## ğŸ¨ æœ€ä½³å®è·µ

### âœ… æ¨èåšæ³•

1. **ä½¿ç”¨å¤šå±‚é€‰æ‹©å™¨**
   ```javascript
   const titleEl = safeQuery(document, [
       '[data-testid="title"]',  // æœ€ç¨³å®š
       'h1.article-title',       // æ¬¡é€‰
       'h1[class*="title"]',     // å¤‡é€‰
       'h1'                      // å…œåº•
   ]);
   ```

2. **ç»Ÿä¸€ä½¿ç”¨å·¥å…·å‡½æ•°**
   ```javascript
   article.title = cleanText(titleEl.textContent);
   article.publishTime = formatTime(timeEl.textContent);
   article.author.avatar = normalizeUrl(avatarImg.src);
   ```

3. **éªŒè¯æ•°æ®å®Œæ•´æ€§**
   ```javascript
   const validation = validateArticle(article);
   if (!validation.valid) {
       throw new Error('Validation failed: ' + validation.errors.join(', '));
   }
   ```

### âŒ é¿å…åšæ³•

1. âŒ ç›´æ¥ä½¿ç”¨ `querySelector` - åº”ä½¿ç”¨ `safeQuery`
2. âŒ æ‰‹åŠ¨æ ¼å¼åŒ–æ—¶é—´ - åº”ä½¿ç”¨ `formatTime`
3. âŒ ä¸éªŒè¯æ•°æ®å°±è¿”å› - åº”ä½¿ç”¨ `validateArticle`
4. âŒ ä½¿ç”¨ç¡¬ç¼–ç çš„å•ä¸€é€‰æ‹©å™¨ - åº”æä¾›å¤šä¸ªå¤‡é€‰
5. âŒ ä¸æ¸…ç†æ–‡æœ¬ - åº”ä½¿ç”¨ `cleanText`

## ğŸ” è°ƒè¯•æŒ‡å—

### 1. æ£€æŸ¥é€‰æ‹©å™¨
```javascript
// æµ‹è¯•é€‰æ‹©å™¨æ˜¯å¦æœ‰æ•ˆ
const testEl = safeQuery(document, ['.test-selector']);
console.log('æ‰¾åˆ°å…ƒç´ :', testEl);
```

### 2. æŸ¥çœ‹æå–çš„æ•°æ®
```javascript
// åœ¨è¿”å›å‰æ‰“å°å®Œæ•´æ•°æ®
console.log('æœ€ç»ˆæ•°æ®:', JSON.stringify(article, null, 2));
```

### 3. éªŒè¯æ•°æ®
```javascript
const validation = validateArticle(article);
console.log('éªŒè¯ç»“æœ:', validation);
if (!validation.valid) {
    console.error('ç¼ºå¤±å­—æ®µ:', validation.errors);
}
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. âœ… ä½¿ç”¨ `safeQuery` è€Œä¸æ˜¯å¤šæ¬¡ `querySelector`
2. âœ… é¿å…åœ¨å¾ªç¯ä¸­é‡å¤æŸ¥è¯¢ç›¸åŒå…ƒç´ 
3. âœ… ä½¿ç”¨ `safeQueryAll` ä¸€æ¬¡æ€§è·å–æ‰€æœ‰å…ƒç´ 
4. âœ… åªåœ¨éœ€è¦æ—¶æ‰æå–è¯„è®º(è¯„è®ºé€šå¸¸è¾ƒå¤š)

## ğŸš€ æœªæ¥æ‰©å±•

### å¯èƒ½çš„å¢å¼ºåŠŸèƒ½

1. **ç¼“å­˜æœºåˆ¶** - å‡å°‘é‡å¤æŸ¥è¯¢
2. **é”™è¯¯ä¸ŠæŠ¥** - æ”¶é›†çº¿ä¸Šçˆ¬å–å¤±è´¥case
3. **é€‰æ‹©å™¨è‡ªé€‚åº”** - è‡ªåŠ¨å­¦ä¹ æœ€ç¨³å®šçš„é€‰æ‹©å™¨
4. **æ€§èƒ½ç›‘æ§** - ç»Ÿè®¡å„å¹³å°çˆ¬å–è€—æ—¶
5. **æ•°æ®ç»Ÿè®¡** - åˆ†æå„å­—æ®µçš„æå–æˆåŠŸç‡

### æ”¯æŒæ›´å¤šå¹³å°

æŒ‰ç…§ç›¸åŒçš„è§„èŒƒ,å¯ä»¥è½»æ¾æ·»åŠ :
- çŸ¥ä¹
- å¾®åš
- å‡¤å‡°ç½‘
- æ–°æµªæ–°é—»
- ç­‰å…¶ä»–å¹³å°

## ğŸ“ å¸¸è§é—®é¢˜

### Q1: å¦‚ä½•å¤„ç†å¤šç§é¡µé¢æ ¼å¼?
A: åœ¨ `safeQuery` ä¸­æä¾›æ‰€æœ‰å¯èƒ½çš„é€‰æ‹©å™¨,å‡½æ•°ä¼šè‡ªåŠ¨å°è¯•ç›´åˆ°æ‰¾åˆ°åŒ¹é…çš„å…ƒç´ ã€‚

### Q2: æ—¶é—´æ ¼å¼è½¬æ¢æ”¯æŒå“ªäº›æ ¼å¼?
A: æ”¯æŒç›¸å¯¹æ—¶é—´("åˆšåˆš"ã€"5åˆ†é’Ÿå‰")ã€ä¸­æ–‡æ ¼å¼("2024å¹´11æœˆ20æ—¥")ã€ISOæ ¼å¼ç­‰,è¯¦è§ `formatTime` å‡½æ•°ã€‚

### Q3: å¦‚ä½•å¤„ç†è¯„è®ºçš„æ ‘å½¢ç»“æ„?
A: ä½¿ç”¨ `children` å­—æ®µå­˜å‚¨å­è¯„è®º,å»ºè®®æœ€å¤šæ”¯æŒ2å±‚åµŒå¥—,ç¤ºä¾‹è§ [tencent.js](crawlers/tencent.js)ã€‚

### Q4: å›¾ç‰‡çš„srcå¯èƒ½æ˜¯data-srcæ€ä¹ˆåŠ?
A: `extractImage` å‡½æ•°ä¼šè‡ªåŠ¨å°è¯• `src`ã€`data-src`ã€`data-original`ã€`data-lazy-src` ç­‰å±æ€§ã€‚

### Q5: å¦‚ä½•è¿‡æ»¤æ‰ä¸éœ€è¦çš„å…ƒç´ ?
A: ä½¿ç”¨CSSé€‰æ‹©å™¨çš„ `:not()` è¯­æ³•,ä¾‹å¦‚ `p:not([class*="copyright"])`ã€‚

## ğŸ“Š å®æ–½ç»Ÿè®¡

- **æ€»æ–‡ä»¶æ•°**: 9ä¸ª (2ä¸ªæ ¸å¿ƒ + 7ä¸ªçˆ¬è™«)
- **ä»£ç è¡Œæ•°**: ~3000è¡Œ
- **å·¥å…·å‡½æ•°æ•°**: 11ä¸ª
- **è¦†ç›–å¹³å°æ•°**: 7ä¸ª
- **ç»Ÿä¸€å­—æ®µæ•°**: 10ä¸ª
- **å®æ–½æ—¶é—´**: 2024-11-20
- **æ–‡æ¡£é¡µæ•°**: 3ä¸ª

## âœ¨ æ€»ç»“

æœ¬æ¬¡ç»Ÿä¸€æ•°æ®æ ¼å¼å®æ–½:
1. âœ… æå‡äº†ä»£ç è´¨é‡å’Œå¯ç»´æŠ¤æ€§
2. âœ… ç¡®ä¿äº†7ä¸ªå¹³å°æ•°æ®100%ç»Ÿä¸€
3. âœ… æä¾›äº†å®Œå–„çš„å·¥å…·å‡½æ•°å’Œæ–‡æ¡£
4. âœ… å»ºç«‹äº†å¯æ‰©å±•çš„æ¶æ„
5. âœ… ä¸ºåç»­åŠŸèƒ½å¼€å‘æ‰“ä¸‹åšå®åŸºç¡€

æ‰€æœ‰å¹³å°çš„çˆ¬è™«ç°åœ¨éƒ½éµå¾ªç»Ÿä¸€çš„è§„èŒƒ,è¿”å›ä¸€è‡´çš„æ•°æ®ç»“æ„,æå¤§åœ°ç®€åŒ–äº†åç»­çš„æ•°æ®å¤„ç†å’ŒåŠŸèƒ½å¼€å‘å·¥ä½œ!

---

**æœ€åæ›´æ–°**: 2024-11-20
**ç‰ˆæœ¬**: 1.0
**ç»´æŠ¤è€…**: AiMaster Team
